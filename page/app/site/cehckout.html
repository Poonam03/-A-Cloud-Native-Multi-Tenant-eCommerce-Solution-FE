<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        if (window.localStorage.getItem('token') === undefined) {
            window.localStorage.clear();
            window.location.href = '/app/site/login.html'
        } else {
            const myHeaders = new Headers();
            myHeaders.append("Authorization", window.localStorage.getItem('token'));

            const requestOptions = {
                method: "GET",
                headers: myHeaders,
                redirect: "follow"
            };

            fetch("http://localhost:8080/mt/v1/user", requestOptions)
                .then((response) => {
                    if (!response.ok) {
                        window.localStorage.clear();
                        window.location.href = '/app/site/login.html'
                    }
                })
                .catch((error) => {
                    window.localStorage.clear();
                    window.location.href = '/app/site/login.html'
                });
        }

    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="multikart">
    <meta name="keywords" content="multikart">
    <meta name="author" content="multikart">
    <link rel="icon" href="../assets/images/favicon/25.png" type="image/x-icon">
    <link rel="shortcut icon" href="../assets/images/favicon/25.png" type="image/x-icon">
    <title>Multikart - Multi-purpose E-commerce Html Template</title>

    <!--Google font-->
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Yellowtail&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/font-awesome.css">

    <!--Slick slider css-->
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/slick.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/slick-theme.css">

    <!-- Animate icon -->
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/animate.css">

    <!-- Themify icon -->
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/themify-icons.css">

    <!-- Bootstrap css -->
    <link rel="stylesheet" type="text/css" href="../assets/css/vendors/bootstrap.css">

    <!-- Theme css -->
    <link rel="stylesheet" type="text/css" href="../assets/css/style.css">

</head>

<body class="theme-color-29">

<!-- header start -->
<header class="header-tools zindex-up header-style top-relative">
    <div class="mobile-fix-option"></div>
    <div class="logo-menu-part">
        <div class="container container-lg border-bottom-0 rounded-5">
            <div class="row">
                <div class="col-sm-12">
                    <div class="main-menu">
                        <div class="menu-left">
                            <div class="brand-logo">
                                <a href="index.html"> <img src="../assets/images/icon/logo/36.png"
                                                           class="img-fluid blur-up lazyload" alt=""></a>
                            </div>
                        </div>
                        <div class="menu-right pull-right">
                            <div>
                                <nav id="main-nav">
                                    <div class="toggle-nav"><i class="fa fa-bars sidebar-bar"></i></div>
                                    <ul id="main-menu" class="sm pixelstrap sm-horizontal">
                                        <li>
                                            <div class="mobile-back text-end">Back<i class="fa fa-angle-right ps-2"
                                                                                     aria-hidden="true"></i></div>
                                        </li>
                                        <li><a href="index.html">Home</a></li>
                                        <li><a href="cehckout.html">Checkout</a></li>
                                        <li id="user"></li>
                                    </ul>
                                </nav>
                            </div>
                            <div class="top-header">
                                <ul class="header-dropdown">
                                    <li class="onhover-dropdown mobile-account">
                                        <img src="../assets/images/icon/user-1.png" alt="">
                                        <span id = "login" style="color:black"></span>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <div class="icon-nav">
                                    <ul>
                                        <li class="onhover-div mobile-setting">
                                            <div><img src="../assets/images/icon/setting-1.png"
                                                      class="img-fluid blur-up lazyload" alt="">
                                                <i class="ti-settings"></i>
                                            </div>
                                            <div class="show-div setting">
                                                <h6>language</h6>
                                                <ul>
                                                    <li><a href="#">english</a></li>
                                                </ul>

                                            </div>
                                        </li>
                                        <li class="onhover-div mobile-cart">
                                            <a href="cart.html">
                                                <div><img src="../assets/images/icon/cart-1.png"
                                                          class="img-fluid blur-up lazyload" alt="">
                                                    <i class="ti-shopping-cart"></i>
                                                </div>
                                            </a>

                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- header end -->


<!-- category section start -->
<!--section start-->
<section class="cart-section section-b-space">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="cart_counter">
                    <h4>Cart</h4>
                </div>
            </div>
            <div class="col-sm-12 table-responsive-xs">
                <table class="table cart-table">
                    <thead>
                    <tr class="table-head">
                        <th scope="col">image</th>
                        <th scope="col">product name</th>
                        <th scope="col">price</th>
                        <th scope="col">quantity</th>
                        <th scope="col">action</th>
                        <th scope="col">total</th>
                    </tr>
                    </thead>
                    <tbody id ='category'></tbody>
                </table>
                <div class="table-responsive-md">
                    <table class="table cart-table ">
                        <tfoot>
                        <tr>
                            <td>total price :</td>
                            <td>
                                <h2 id="total-price"> 0 <i class="fa fa-inr" ></i></h2>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <div class="row cart-buttons">
            <div class="col-6"><a href="javascript:checkout()" class="btn btn-solid">check out</a></div>
        </div>
    </div>
</section>
<!--section end-->


<!-- footer -->
<footer class="footer-light">
    <div class="light-layout">
        <div class="container container-lg">
            <section class="small-section border-section border-top-0">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="subscribe">
                            <div>
                                <h4>KNOW IT ALL FIRST!</h4>
                                <p>Never Miss Anything From Multikart By Signing Up To Our Newsletter.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <form
                                action="https://pixelstrap.us19.list-manage.com/subscribe/post?u=5a128856334b598b395f1fc9b&amp;id=082f74cbda"
                                class="form-inline subscribe-form auth-form needs-validation" method="post"
                                id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
                            <div class="form-group mx-sm-3">
                                <input type="text" class="form-control" name="EMAIL" id="mce-EMAIL"
                                       placeholder="Enter your email" required="required">
                            </div>
                            <button type="submit" class="btn btn-solid btn-gradient"
                                    id="mc-submit">subscribe
                            </button>
                        </form>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="sub-footer">
        <div class="container container-lg">
            <div class="row">
                <div class="col-xl-6 col-md-6 col-sm-12">
                    <div class="footer-end">
                        <p><i class="fa fa-copyright" aria-hidden="true"></i> E-Commerce Website</p>
                    </div>
                </div>
                <div class="col-xl-6 col-md-6 col-sm-12">
                    <div class="payment-card-bottom">
                        <ul>
                            <li>
                                <a href="#"><img src="../assets/images/icon/visa.png" alt=""></a>
                            </li>
                            <li>
                                <a href="#"><img src="../assets/images/icon/mastercard.png" alt=""></a>
                            </li>
                            <li>
                                <a href="#"><img src="../assets/images/icon/paypal.png" alt=""></a>
                            </li>
                            <li>
                                <a href="#"><img src="../assets/images/icon/american-express.png" alt=""></a>
                            </li>
                            <li>
                                <a href="#"><img src="../assets/images/icon/discover.png" alt=""></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- footer end -->


<!-- subscribe start -->
<div class="cookie-bar left-bottom subscribe-box">
    <h2>hey you !!</h2>
    <p>Join our subscribers list to get the latest updates and special offers delivered directly in your inbox</p>
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Enter your Email" aria-label="Recipient's username"
               aria-describedby="button-addon2">
        <button class="btn btn-solid btn-sm btn-gradient" type="button" id="button-addon2">subscribe</button>
    </div>
    <a href="javascript:void(0)" class="btn-close"><i class="fa fa-times" aria-hidden="true"></i></a>
</div>


<!-- tap to top start -->
<div class="tap-top gradient-top">
    <div><i class="fa fa-angle-double-up"></i></div>
</div>
<!-- tap to top end -->


<!-- latest jquery-->
<script src="../assets/js/jquery-3.3.1.min.js"></script>

<!-- slick js-->
<script src="../assets/js/slick.js"></script>
<script src="../assets/js/slick-animation.min.js"></script>

<!-- wow js-->
<script src="../assets/js/wow.min.js"></script>

<!-- menu js-->
<script src="../assets/js/menu.js"></script>

<!-- lazyload js-->
<script src="../assets/js/lazysizes.min.js"></script>

<!-- Bootstrap js-->
<script src="../assets/js/bootstrap.bundle.min.js"></script>

<!-- Bootstrap Notification js-->
<script src="../assets/js/bootstrap-notify.min.js"></script>

<!-- Theme js-->
<script src="../assets/js/theme-setting.js"></script>
<script src="../assets/js/color-setting.js"></script>
<script src="../assets/js/script.js"></script>
<script src="../assets/js/custom-slick-animated.js"></script>

<script>
    new WOW().init();


    const user = document.getElementById('user');
    user.innerHTML = `${window.localStorage.getItem('userName') ? ` <a href="javascript:logout()">Logout</a>`: `<a href="login.html">Login</a>`}`;

    const username = document.getElementById('login');
    username.innerText = `${window.localStorage.getItem('userName') ? `${window.localStorage.getItem('userName')}`: 'Guest'}`;
    function logout() {
        window.localStorage.removeItem('userName');
        window.location.href = 'login.html';
    }


    const category = document.getElementById('category');

    let innerHtml = ``;
    let cart = window.localStorage.getItem('cart') !== undefined ? JSON.parse(window.localStorage.getItem('cart')) : {};
    let price = 0;
    for(var key in  cart){
        innerHtml += `
                    <tr>
                        <td>
                            <a href="#"><img src="${cart[key]['image']}" alt=""></a>
                        </td>
                        <td><a href="#">${cart[key]['name']}</a>
                            <div class="mobile-cart-content row">
                                <div class="col">
                                    <div class="qty-box">
                                        <div class="input-group">
                                            <input type="text" disabled="true" readonly name="quantity" class="form-control input-number"
                                                   value="1">
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <h2 class="td-color">${cart[key]['price']} <i class="fa fa-inr" ></i></h2>
                                </div>
                                <div class="col">
                                    <h2 class="td-color"><a  class="icon"><i class="ti-close"></i></a>
                                    </h2>
                                </div>
                            </div>
                        </td>
                        <td>
                            <h2>${cart[key]['price']} <i class="fa fa-inr" ></i></h2>
                        </td>
                        <td>
                            <div class="qty-box">
                                <div class="input-group">
                                    <input type="number" name="quantity" class="form-control input-number"
                                           value="${cart[key]['quantity']}">
                                </div>
                            </div>
                        </td>
                        <td><a href="javascript:remove('${key}')" class="icon"><i class="ti-close"></i></a></td>
                        <td>
                            <h2 class="td-color">${cart[key]['price'] * cart[key]['quantity']} <i class="fa fa-inr" ></i></h2>
                        </td>
                    </tr>
                    `;
        price += cart[key]['price'] * cart[key]['quantity'];
    }



    document.getElementById('total-price').innerHTML = price + '<i class="fa fa-inr" ></i>';

    category.innerHTML = innerHtml;


    function remove(key){
        let cart = window.localStorage.getItem('cart');
        if(cart !== undefined){
            cart = JSON.parse(cart);
            delete cart[key];
            window.localStorage.setItem('cart', JSON.stringify(cart));
        }
        window.location.reload();
    }

    function checkout(){
        let cart = JSON.parse(window.localStorage.getItem('cart'));

        if(cart === undefined || cart === null || cart.length === 0 || Object.keys(cart).length === 0){
            window.alert('Add Product in cart')
        } else{
            let data = {
                "userInfoBO": JSON.parse(window.localStorage.getItem('user')),
                "vendorId": window.localStorage.getItem('store'),
                "orderStatus": "CREATE",
                "phone": JSON.parse(window.localStorage.getItem('user'))['phone'],
                "addressLine1": JSON.parse(window.localStorage.getItem('user'))['addressLine1'],
                "addressLine2": JSON.parse(window.localStorage.getItem('user'))['addressLine2'],
                "city": JSON.parse(window.localStorage.getItem('user'))['city'],
                "state": JSON.parse(window.localStorage.getItem('user'))['state'],
                "country": JSON.parse(window.localStorage.getItem('user'))['country'],
                "zipCode": JSON.parse(window.localStorage.getItem('user'))['zipCode'],
                productBO: []
            }
            for(let key in cart){
                data.productBO.push({
                    "id": key,
                    "quantity": cart[key]['quantity'],
                })
            }
            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", window.localStorage.getItem('token'));

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: JSON.stringify(data),
                redirect: "follow"
            };

            fetch("http://localhost:8080/mt/v1/order?vendor="+window.localStorage.getItem('store'), requestOptions)
                .then((response) => {
                    if(response.ok){
                        alert('Order has been placed')
                        window.localStorage.removeItem('cart');
                    } else {
                        response.json().then((data) => {alert(data.message)});
                    }
                })
                .catch((error) => alert(error));

        }

    }

</script>
</body>

</html>